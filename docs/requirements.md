# 要件定義書

## 目的・ゴール
- スマホのGoogleフォームで「始業前点検」を実施し、スプレッドシートに自動記録する
- 不適合項目が1つでもあれば、同スプレッドシート内にissuesシートを自動作成して是正依頼を1行起票する
- Script Properties の `NOTIFICATION_EMAIL` が設定されている場合のみ、メール通知を送信する
- 写真は扱わない（チェック項目のみ）

## 前提条件・制約
- Google Workspace/Googleアカウント使用
- Googleフォームは作成済み（指定の設問名に準拠）
- フォーム回答をスプレッドシートにリンク済み
- Apps Scriptはコンテナバインド + フォーム送信（インストール型）トリガーを利用する
- タイムゾーン：Asia/Tokyo
- VS Code + claspでの編集・デプロイ

## フォーム設問仕様
### メタ項目（基本情報）
- 設備ID（記述）
- 点検者（記述）
- 点検日（日付）
- 備考（段落）

### チェック項目（選択肢：適合/不適合/N/A）
- 潤滑油量
- 安全カバー
- 異音
- その他（追加可能）

## システム動作仕様
1. フォーム送信時にonFormSubmit(e)が自動起動
2. e.namedValuesからメタ項目を取得
3. チェック項目を走査し、「不適合/NG/×/x」を含む回答があればNG判定
4. NG時：issuesシートが無ければ作成し、1行起票
5. NOTIFICATION_EMAIL設定時のみメール通知送信
6. 全て適合の場合は何もしない

## issuesシート仕様
### ヘッダ行
ID, 状態, 設備ID, 点検日, 点検者, 不適合項目, 備考, 起票日, 期限, 完了日

### データ仕様
- ID: 'ISS-' + 8桁UUID断片
- 状態: 固定で '新規'
- 設備ID/点検日/点検者/備考: フォーム回答から転記
- 不適合項目: NG項目を '/' 区切りで連結
- 起票日: 送信日をyyyy-MM-dd形式
- 期限: 起票日 + DEFAULT_DEADLINE_DAYS（Script Properties、未設定時7日）
- 完了日: 空白（運用時に手動または自動入力）

## 技術要件
- 外部ライブラリ不使用
- 例外でスクリプトが停止しないよう最小限のnullガード
- 日本語コメント・JSDoc風説明付与
- 1ファイル完結（Code.gs）
- 省略記法（...）は使用しない

## エラー処理・リカバリ
- e/e.namedValues欠落時は即return
- issuesシート新規作成時はヘッダ行を1度だけ追加
- NOTIFICATION_EMAIL未設定時はメール送信をスキップ
- 重複起票防止: Timestamp + 設備IDの一意キーで既存チェック
- 設備ID欠損時は起票せず警告ログのみ出力

## 受け入れ基準
- 不適合回答でissuesに正しく記録される
- 期限がDEFAULT_DEADLINE_DAYSで計算される
- NOTIFICATION_EMAIL未設定時はメール送信しない
- 全適合時はissues追加されない
- 同一キー（Timestamp+設備ID）の重複起票が発生しない
- メール本文にissuesシートのURLが含まれる

## 成功基準
- フォーム送信から自動記録まで正常動作
- 不適合項目の正確な検出・記録
- メール通知機能の正常動作（設定時のみ）